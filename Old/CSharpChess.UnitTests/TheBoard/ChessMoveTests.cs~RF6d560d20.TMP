using CSharpChess.TheBoard;
using CSharpChess.UnitTests.Helpers;
using NUnit.Framework;
using NUnit.Framework.Constraints;

namespace CSharpChess.UnitTests.TheBoard
{
    [TestFixture]
    public class ChessMoveTests
    {
        [TestCase("A2A4", Chess.ChessFile.A, 2, Chess.ChessFile.A, 4)]
        [TestCase("b7-b6", Chess.ChessFile.B, 7, Chess.ChessFile.B, 6)]
        public void can_explicitly_parse_move_strings(string move, Chess.ChessFile fromFile, int fromRank, Chess.ChessFile toFile, int toRank)
        {
            var chessMove = (ChessMove) move;

            Assert.That(chessMove.From.File, Is.EqualTo(fromFile));
            Assert.That(chessMove.From.Rank, Is.EqualTo(fromRank));
            Assert.That(chessMove.To.File, Is.EqualTo(toFile));
            Assert.That(chessMove.To.Rank, Is.EqualTo(toRank));
        }

        [TestCase("A7A8Q", Chess.PieceNames.Queen)]
        [TestCase("A7-A8N", Chess.PieceNames.Knight)]
        [TestCase("A7A8=R", Chess.PieceNames.Rook)]
        [TestCase("A7-A8=b", Chess.PieceNames.Bishop)]
        public void can_explicitly_parse_move_strings_with_promotions(string move, Chess.PieceNames pieceName)
        {
            var chessMove = (ChessMove)move;

            Assert.That(chessMove.From.File, Is.EqualTo(Chess.ChessFile.A));
            Assert.That(chessMove.From.Rank, Is.EqualTo(7));
            Assert.That(chessMove.To.File, Is.EqualTo(Chess.ChessFile.A));
            Assert.That(chessMove.To.Rank, Is.EqualTo(8));
            Assert.That(chessMove.MoveType, Is.EqualTo(MoveType.Promotion));
            Assert.That(chessMove.PromotedTo, Is.EqualTo(pieceName));
        }

        [Test]
        public void can_parse_pgn()
        {
            var expected = (ChessMove) "e2-e4";
            var pgnMove = "e4";
            var board = BoardBuilder.NewGame;

            var chessMove = new PgnChessMoveAdapter(board, pgnMove);

            Assert.That(chessMove.Rank, Is.EqualTo(expected.From.Rank));
            Assert.That(chessMove.File, Is.EqualTo(expected.From.File));
            Assert.That(chessMove.MoveType, Is.EqualTo(MoveType.Move));
        }
    }

    public class PgnChessMoveAdapter
    {
        public Chess.ChessFile File { get; }
        public int Rank { get; }
        public MoveType MoveType { get; }

        public PgnChessMoveAdapter(ChessBoard board, string pgnMove)
        {
            throw new System.NotImplementedException();
        }

    }
}